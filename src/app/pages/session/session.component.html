<div class="container mx-auto p-4">
  @if (session().length > 0) {
  <div class="results-container">
    <div class="results-grid">
      @for (result of session(); track result.sessionKey + '-' + result.driverNumber) {
      <div class="result-card">
        <div class="position-badge" [class.podium]="result.position <= 3">
          <span class="position-number">{{ result.position }}</span>
        </div>

        @let driver = getDriverByNumber(result.driverNumber);
        <img
          [src]="driver?.headshotUrl ?? 'img/png/driver-placeholder.png'"
          [alt]="driver?.fullName"
          [title]="driver?.fullName"
          class="driver-headshot"
          alt="driver-img"
        />

        <div class="result-content">
          <div class="driver-info">
            <div class="driver-identity">
              @if (getDriverByNumber(result.driverNumber); as driver) {
              <div class="driver-name-container">
                <span class="driver-name">
                  <span class="driver-number">#{{ result.driverNumber }}</span>
                  {{ driver.firstName }} {{ driver.lastName }}
                </span>
                <span class="driver-acronym">{{ driver.nameAcronym }}</span>
              </div>
              }
            </div>

            <div class="status-badges">
              @if (result.dnf) {
              <span class="badge dnf">DNF</span>
              } @if (result.dns) {
              <span class="badge dns">DNS</span>
              } @if (result.dsq) {
              <span class="badge dsq">DSQ</span>
              }
            </div>
          </div>

          <div class="result-stats">
            <div class="stat-item">
              <span class="stat-label">Laps</span>
              <span class="stat-value">{{ result.numberOfLaps }}</span>
            </div>

            @if (result.duration) {
            <div class="stat-item">
              <span class="stat-label">Duration</span>
              <span class="stat-value">{{ formatDuration(result.duration) }}</span>
            </div>
            } @if (result.gapToLeader && result.position > 1) {
            <div class="stat-item">
              <span class="stat-label">Gap</span>
              <span class="stat-value gap">
                @if (typeof result.gapToLeader === 'number') { +{{ formatGap(result.gapToLeader) }}
                } @else {
                {{ result.gapToLeader }}
                }
              </span>
            </div>
            }
          </div>
        </div>
      </div>
      }
    </div>
  </div>
  } @else {
  <div class="no-results">
    <p>No session results available</p>
  </div>
  }
</div>

<app-laps-info [drivers]="drivers()" [laps]="laps()"></app-laps-info>
